<?xml version='1.0'?>

<robot name="duckiebot" xmlns:xacro="http://www.ros.org/wiki/xacro">

  <xacro:property name="cameraSize" value="0.01"/>
  <xacro:property name="cameraMass" value="0.01"/>
  <xacro:property name="compuMass" value="0.01"/>

  <!-- Constants -->
  <xacro:property name="PI" value="3.1415926535897931"/>

  <!-- Chassis properties -->
  <xacro:property name="chassisHeight" value="0.0623"/>
  <xacro:property name="chassisLength" value="0.198"/>
  <xacro:property name="chassisWidth" value="0.119"/>
  <xacro:property name="chassisMass" value="0.15"/>

  <!-- Caster wheel properties -->
  <xacro:property name="casterRadius" value="0.021"/>
  <xacro:property name="casterMass" value="0.09"/>
  <xacro:property name="casterOffsetX" value="0.091"/>

  <!-- Differential-drive wheels properties -->
  <xacro:property name="wheelWidth" value="0.026"/>
  <xacro:property name="wheelRadius" value="0.032"/>
  <xacro:property name="wheelMass" value="0.05"/>
  <xacro:property name="wheelOffsetY" value="0.037"/>

  <xacro:include filename="$(find duckiebot_description)/urdf/duckiebot.gazebo" />
  <xacro:include filename="$(find duckiebot_description)/urdf/materials.xacro" />
  <xacro:include filename="$(find duckiebot_description)/urdf/macros.xacro" />

  <pose>0 0 0 0 0 0</pose>


  <link name='chassis'>

    <inertial>
      <mass value="${chassisMass}"/>
      <origin xyz="-0.05 0 0" rpy=" 0 0 0"/>
      <inertia
        ixx="1.56167e-05" ixy="0.0" ixz="0.0"
        iyy="1.56167e-05" iyz="0.0"
        izz="2.56e-05"/>
    </inertial>


    <collision name='collision'>
      <origin xyz="0 0 0" rpy=" 0 0 0"/>
      <geometry>
        <mesh filename="package://duckiebot_description/meshes/duckiebotFrame.dae"/>
      </geometry>
    </collision>

    <visual name='chassis_visual'>
      <origin xyz="0 0 0" rpy=" 0 0 0"/>
      <geometry>
        <mesh filename="package://duckiebot_description/meshes/duckiebotFrame.dae"/>
      </geometry>
      <material name="red"/>
    </visual>

  </link>


  <link name="left_wheel">
    <origin xyz="0 0 0" rpy="0 0 0"/>
    <collision name="collision">
      <origin xyz="0 -0.07 0" rpy="0 0 0"/>
      <geometry>
        <mesh filename="package://duckiebot_description/meshes/duckiebot_leftwheel.dae"/>
      </geometry>
    </collision>
    <visual name="left_wheel_visual">
      <origin xyz="0 -0.07 0" rpy="0 0 0"/>
      <geometry>
        <mesh filename="package://duckiebot_description/meshes/duckiebot_leftwheel.dae"/>      
      </geometry>
      <material name="black"/>

    </visual>
    <inertial>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <mass value="${wheelMass}"/>
      <cylinder_inertia m="${wheelMass}" r="0.0325" h="0.02"/>
      <inertia
        ixx="0.56167e-05" ixy="0.0" ixz="0.0"
        iyy="0.56167e-05" iyz="0.0"
        izz="1.56e-05"/>
    </inertial>
  </link>

  <link name="right_wheel">
    <origin xyz="0 0 0" rpy="0 0 0"/>
    <collision name="collision">
      <origin xyz="0 0.07 0" rpy="0 0 0"/>
      <geometry>
        <mesh filename="package://duckiebot_description/meshes/duckiebot_rightwheel.dae"/> 
      </geometry>
    </collision>
    <visual name="right_wheel_visual">
      <origin xyz="0 0.07 0" rpy="0 0 0"/>
      <geometry>
        <mesh filename="package://duckiebot_description/meshes/duckiebot_rightwheel.dae"/>    
      </geometry>
      <material name="black"/>

    </visual>
    <inertial>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <mass value="${wheelMass}"/>
      <cylinder_inertia m="${wheelMass}" r="0.0325" h="0.01"/>
      <inertia
        ixx="0.56167e-05" ixy="0.0" ixz="0.0"
        iyy="0.56167e-05" iyz="0.0"
        izz="1.56e-05"/>
    </inertial>
  </link>


  <joint type="continuous" name="left_wheel_hinge">
    <origin xyz="0.0 0.07 0" rpy="0 0 0"/>
    <child link="left_wheel"/>
    <parent link="chassis"/>
    <axis xyz="0 1 0" rpy="0 0 0"/>
    <limit effort="100" velocity="100"/>
    <joint_properties damping="0.0" friction="0.0"/>
  </joint>

  <joint type="continuous" name="right_wheel_hinge">
    <origin xyz="0.0 -0.07 0" rpy="0 0 0"/>
    <child link="right_wheel"/>
    <parent link="chassis"/>
    <axis xyz="0 1 0" rpy="0 0 0"/>
    <limit effort="100" velocity="100"/>
    <joint_properties damping="0.0" friction="0.0"/>
  </joint>

<!-- Computer -->


<link name="computer">
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <mesh filename="package://duckiebot_description/meshes/duckiebot_computer.dae"/>
      </geometry>
    </collision>


    <visual name='comp_visual'>
      <origin xyz="0 0 0" rpy=" 0 0 0"/>
      <geometry>
        <mesh filename="package://duckiebot_description/meshes/duckiebot_computer.dae"/>
      </geometry>
      <material name="blue"/>
    </visual>

    <inertial>
      <mass value="${compuMass}" />
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <inertia ixx="1e-6" ixy="0" ixz="0" iyy="1e-6" iyz="0" izz="1e-6" />
    </inertial>
  </link>
  
<link name="imu_link">
  <inertial>
    <mass value="0.01"/>
    <origin xyz="0 0 0" rpy="0 0 0"/>
    <inertia ixx="1e-6" ixy="0" ixz="0" iyy="1e-6" iyz="0" izz="1e-6"/>
  </inertial>

  <visual>
    <origin xyz="0 0 0"/>
    <geometry>
      <box size="0.01 0.01 0.01"/>
    </geometry>
    <material name="blue"/>
  </visual>

  <collision>
    <origin xyz="0 0 0"/>
    <geometry>
      <box size="0.01 0.01 0.01"/>
    </geometry>
  </collision>

  <!-- Gazebo-native IMU -->
  <gazebo>
    <sensor type="imu" name="imu_sensor">
      <always_on>1</always_on>
      <update_rate>50</update_rate>
      <visualize>true</visualize>
      <topic>imu/data_raw</topic>
      <imu>
        <angular_velocity>
          <x>1</x>
          <y>1</y>
          <z>1</z>
        </angular_velocity>
        <linear_acceleration>
          <x>1</x>
          <y>1</y>
          <z>1</z>
        </linear_acceleration>
      </imu>
      <noise>
        <angular_velocity>
          <mean>0.0</mean>
          <stddev>0.0001</stddev>
        </angular_velocity>
        <linear_acceleration>
          <mean>0.0</mean>
          <stddev>0.0001</stddev>
        </linear_acceleration>
      </noise>
    </sensor>
  </gazebo>

</link>


<!-- Fixed joint attaching IMU to the computer -->
<joint name="imu_joint" type="fixed">
  <parent link="computer"/>
  <child link="imu_link"/>
  <origin xyz="0 0 0" rpy="0 0 0"/>
</joint>

  <joint name="computer_joint" type="fixed">
    <axis xyz="0 0 0" />
    <origin xyz="0 0 0" rpy="0 0 0"/>
    <parent link="chassis"/>
    <child link="computer"/>
  </joint>

<!-- Camera sensor -->

<link name="camera">
    <pose>0 0 0 0 0 0</pose>

    <collision>
      <origin xyz="-0.05 0 -0.055" rpy="0 -0.1 0"/>
      <geometry>
        <mesh filename="package://duckiebot_description/meshes/duckiebot_camera.dae"/>
      </geometry>
    </collision>


    <visual name='camvisual'>
      <origin xyz="-0.05 0 -0.055" rpy=" 0 -0.1 0"/>
      <geometry>
        <mesh filename="package://duckiebot_description/meshes/duckiebot_camera.dae"/>
      </geometry>
      <material name="black"/>
    </visual>

    <inertial>
      <mass value="${cameraMass}" />
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <inertia ixx="1e-6" ixy="0" ixz="0" iyy="1e-6" iyz="0" izz="1e-6" />
    </inertial>
  </link>
  
  

<!-- This joint info decides the pos of camera. Pitch(p in rpy) is angle to control orientation for duckiebot camera.After change values here, you need to change the pos info in collision part anf visual part just above.-->
  <joint name="camera_joint" type="fixed">
    <axis xyz="0 0 0" />
    <origin xyz="0.05 0 0.05" rpy="0 0.1 0"/> 
    <parent link="chassis"/>
    <child link="camera"/>
  </joint>

<!-- Transmissions for wheel joints -->
  <transmission name="left_wheel_trans">
    <type>transmission_interface/SimpleTransmission</type>
    <joint name="left_wheel_hinge"/>
    <actuator name="left_wheel_motor">
      <mechanicalReduction>1</mechanicalReduction>
    </actuator>
  </transmission>

  <transmission name="right_wheel_trans">
    <type>transmission_interface/SimpleTransmission</type>
    <joint name="right_wheel_hinge"/>
    <actuator name="right_wheel_motor">
      <mechanicalReduction>1</mechanicalReduction>
    </actuator>
  </transmission>

  <!-- Gazebo ROS Control plugin -->
  <gazebo>
    <plugin name="gazebo_ros_control" filename="libgazebo_ros_control.so"/>
  </gazebo>

</robot>
